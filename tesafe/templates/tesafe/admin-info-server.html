{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Admin | PWG Server</title>


	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<!-- fontawesome cdn -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Sen&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{% static 'tesafe/css/admin-info-server.css' %}">
</head>
<body>
	<section class="bg-light">
		<div class="container-fluid">
			<nav class="navbar navbar-expand-lg navbar-light ">
				
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse justify-content" id="navbarSupportedContent">
					<ul class="navbar-nav">
						<li class="nav-item pl-3">
							<a class="nav-link "  href="admin-home">Home <span class="sr-only">(current)</span></a>
						</li>
						<li class="nav-item pl-3">
							<a class="nav-link " href="admin-seller">Seller</a>
						</li>
						<li class="nav-item pl-3">
							<a class="nav-link" href="admin-tester">Tester</a>
						</li>
						<li class="nav-item pl-3">
							<a class="nav-link active" href="admin-info-server">PWG Server</a>
						</li>
					</ul>
					
				</div>


				<a class="navbar-brand pr-3" href="#" style="color: green; font-size: 30px; position: relative;"><i class="fas fa-bell"></i><span class="badge badge-danger" style="position: absolute; top: -5px; font-size: 14px; left:15px; ">1</span></a>

				<div class="dropdown  dropleft float-xl-right mb-0" >
					<button  class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown">
						<i class="fas fa-ellipsis-v"></i>
					</button>
					<div class="dropdown-menu">
						<a class="dropdown-item" href="#" onclick="myfun5()">Add New</a>
						<a class="dropdown-item" href="#">Broadcast</a>
						<a class="dropdown-item" href="#" onclick="">Chat</a>
						<a class="dropdown-item" href="#" onclick="myFunction()">Delete</a>
<!--						<a class="dropdown-item" href="#" onclick="freeze()"> Freeze </a>-->
						<a class="dropdown-item" href="#div-2" onclick="myfun4()">Summary PWG</a>
						<a class="dropdown-item" href="admin-home">Exit</a>
					</div>
				</div>
			</nav>
		</div>
	</section>

	<section class="bg-detail">
		<div class="container-fluid">
			<div class="row justify-content-center">


				<!-- for showing error and messages-->
				<div class="col-md-10 py-2 px-5 mt-3" id="msg">

				</div>

				<div class="col-md-10 py-5 px-5">
						<div class="row  bg-button-2 p-4 mt-3" id="div-2">

							<div class="col-md-6">
								<h4 class="font-weight-bold">Summary PWG</h4>
								<div class="tabl-responsive">
									<table class="table">
										<thead>
											<tr>
												<th scope="col">Account Name</th>
												<th scope="col">Total Number</th>
												<th scope="col">Online</th>
												<th scope="col">Offline</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<th scope="row">PWGS</th>
												<td>{{total_pwgs}}</td>
												<td>{{total_pwgs_online}}</td>
												<td>{{total_pwgs_offline}}</td>
											</tr>
											<tr>
												<th scope="row">PWG</th>
												<td>{{total_pwg}}</td>
												<td>{{total_pwg_online}}</td>
												<td>{{total_pwg_offline}}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<div class="row justify-content-center bg-button-2 p-xl-4 mt-3" id="div-1" >
							<div class="col-md">
								<header>
									<nav class="navbar navbar-light  venue-registration">
										<a class="h4 text-dark font-weight-bold pt-2">PWG SERVER LIST</a>
										<form class="form-inline">
											<div class="input-group-prepend mb-1 mr-2">
												<span class="input-group-text" id="addon-wrapping"><i class="fas fa-search fa-1x"></i></span>
												<input type="text" class="form-control" placeholder="Server Name" aria-label="Username" aria-describedby="addon-wrapping" id="myInput">
											</div>

										</form>
									</nav>
								</header>

								<div class="table-responsive">
									<br>
									<table class="table">
										<thead>
											<tr>
												<th scope="col" style="position: relative;"><input type="checkbox" name="checkAll" id="checkAll" value="floatingButtonHere" disabled> <i class="fas fa-sort-down"></i></th>
												<th scope="col">Name</th>
												<th scope="col">Action</th>
											</tr>
										</thead>
										<tbody id="myTable">
										{% for pwg_server in pwgs %}
											<tr data-toggle="tooltip" data-placement="top" title="this PWG is assign to {{pwg_server.transfer_to}}"><th><input type="checkbox" name="floatingButtonHere" disabled value="{{pwg_server.pk}}" class="check"></th>
												<td> {{pwg_server.alias}}</td>
												<td><div class="dropup  mb-0 ml-xl-3  ml-sm-2">
													<button  class="btn btn-light btn-sm dropdown-toggle" data-toggle="dropdown">
														<i class="fas fa-ellipsis-v"></i>
													</button>
													<div class="dropdown-menu">
														<a class="dropdown-item" href="#" onclick="change_name('{{pwg_server.alias}}',{{pwg_server.pk}});">Change Name</a>
														<a class="dropdown-item" href="#">Chat</a>
														<a class="dropdown-item" href="#" onclick="delete_user({{pwg_server.pk}}, 'pwgs')">Delete</a>
														<a class="dropdown-item" href="#" onclick="pop({{pwg_server.user.pk}}, 'pwgs')"> Login Record </a>
														<a class="dropdown-item" href="#" onclick="pwd_history({{pwg_server.user.id}})">Password History</a>
														<a class="dropdown-item" href="pwg-sublist{{pwg_server.pk}}">PWG</a>
													</div>
												</div></td>
											</tr>
										{% endfor %}
										</tbody>
									</table>
								</div>
							</div>

						</div>


						<div class="row justify-content-center bg-button-2 p-4 mt-3" id="div-4" style="display: none;">

							<div class="col-md">
								<h5 class="font-weight-bold"> <span><i class="fas fa-caret-right"></i></span> Add PWG Account</h5>
								<div class="row">
									<div class="col-md-6 py-3">
										{% for msg in messages %}
											<label class="text-danger">{{msg}}</label>
										{% endfor %}
									<form method="post" action="add-new">
                                        {% csrf_token %}
									  <div class="form-group">
									    <input type="text" class="form-control is-integer"  placeholder="Enter Name " name="name" autocomplete="true">
									  </div>
									  <div class="form-group">
									     <input type="text" class="form-control is-integer"  placeholder="Enter Alias Name " name="alias" autocomplete="true">
									  </div>
									  <div class="form-group">
									     <input type="email" class="form-control"  aria-describedby="emailHelp" placeholder="Enter Email " name="email" autocomplete="true" required>
									  </div>
									  <div class="form-group">
									     <input type="password" class="form-control"  placeholder="Enter Password " name="password" autocomplete="true" required>
									  </div>

									  <input type="hidden" value="pwgs" name="accType">

										<button class="btn btn-primary" type="submit" disabled>Submit</button>
										<button class="btn btn-danger" type="button" onclick="cancel()">Cancel</button>
									</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!--	to show login of history-->
    <div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title font-weight-bold" id="modal-title-history">Login History of Seller ABC</h5>
				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			</div>
			<div class="modal-body" id="modal-body-login-history">
				<div class="table-responsive">
					<table class="table">
						<thead>
							<tr>
								<th scope="col">Sr. No.</th>
								<th scope="col">Date</th>
								<th scope="col">Time</th>
								<th scope="col">Device Name</th>
								<th scope="col">Login IP Address</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="row">1</th>
								<td>20/06/5</td>
								<td>5:30pm</td>
								<td>Samsung</td>
								<td>10.2.0.10:8090</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Return</button>
      </div>
		</div>
	</div>
</div>


    <!--    for change alias-->
	<div class="modal fade" id="imagemodal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 id="name-change">Change Name for </h5>
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
				</div>
				<div class="modal-body" id="change-name">
					<form action="change_alias" method="post" name="submit_alias_change">
                        {% csrf_token %}
						<div class="form-group">
							<label>Alias</label>
							<input type="text" class="form-control"  value="" name="alias" id="alias_value">
							<input type="hidden" class="form-control"  id="alias_id" name="alias_id">
							<input type="hidden" class="form-control"  value="pwgs" name="accType">
						</div>
						<button  type="submit" class="btn btn-primary" onclick="submit_alias();" disabled id="btn-alias">Change</button>
						<a  href="#" type="button" class="btn btn-danger" data-dismiss="modal">Cancel</a>
					</form>
				</div>
			</div>
		</div>
	</div>

    <!--	to show confirmation of delete and freeze-->
    <div class="modal fade" id="imagemodalConfirm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
				<a href="" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></a>
			</div>
			<div class="modal-body text-center p-4">
				<i class="fa fa-question-circle fa-3x" style="color: #bd2130;" id="confirm-message-color"></i>
				<p class="pt-2 font-weight-bold" id="confirm-message-delete"></p>

			</div>
			<div class="modal-footer justify-content-center">
				<button type="button" class="btn btn-primary" id="confirm-modal-button" onclick="sendsellerspk();">Confirm</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
		  	</div>
		</div>
	</div>
</div>

    <!--	to show confirmation popup of single delete-->
    <div class="modal fade" id="confirm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Message</h5>
				<a href="" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></a>
			</div>
			<div class="modal-body text-center p-4">
				<i class="fas fa-check-circle fa-3x" style="color: green;" id="confirm-message-color"></i>
				<p class="pt-2 font-weight-bold" id="confirm-message"></p>

			</div>

		</div>
	</div>
</div>


<!--	to delete sellers names-->
	<form action="delete_multiple_user" method="post" name="delete_multiple">
		{% csrf_token %}
		<input type="hidden" id="assign_values" name="values">
		<input type="hidden" value="pwgs" name="accType">

	</form>




<section class="floatingButtonHere" id="floating-button" style="display:none;">
	<a href="#" class="btn btn-primary" id="floating-confirm" onclick="delete_multiple_users()">Proceed</a>
	<a href="admin-info-server" class="btn btn-danger">Cancel</a>
</section>

    <script src="{% static 'tesafe/js/ajax.js' %}"></script>

	<script type="text/javascript">
        let checkbox_values = [];


		// function to check is contains integer or not
		$('.is-integer').on('change', function(){
			var value = $(this).val();
			isnum = /^\d/.test(value)   // to check if it is starting with num
			// isnum = /^\d+$/.test(value);   to check if it is only containing num
			if( isnum ){
				$("#add-new-button").attr("disabled", true);
			}else{
				$("#add-new-button").attr("disabled", false);
			}
		});


		// Shorthand for $( document ).ready()
		$(function() {
			setTimeout(function(){
				$("#msg").removeClass('bg-light');
				$("#msg").html('');
			}, 4000);
			{% if messages %}
			$("#msg").addClass('bg-light');
			{% endif %}
			$("#msg").html('{% for msg in messages %}<h3 class="text-danger">{{msg}}</h3>{% endfor %}');
		});

    // search filter table
        $(document).ready(function(){
            $("#myInput").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });


        // to remove all occurrence of the element
        function removeItemAll(value) {
              var i = 0;
              while (i < checkbox_values.length) {
                    if (checkbox_values[i] === value) {
                      checkbox_values.splice(i, 1);
                    } else {
                      ++i;
                    }
              }
        }




		// check all checkbox in one click

		$('#checkAll').click(function () {

			var ele = $(".check");
			if ($("#checkAll").is(':checked')) {
				$(".check").prop("checked", true);
				for(i=0;i<ele.length;i++){
					checkbox_values.push(ele[i].value);
				}
			}else{
				$(".check").prop("checked", false);
				for(i=0;i<ele.length;i++){
					removeItemAll(ele[i].value);
				}
			}

			if( checkbox_values.length == 0){
				$(".floatingButtonHere").hide();
			}else{
				$(".floatingButtonHere").show(150);
			}
		});



	$('input[type="checkbox"]').click(function(){
		if($(this).attr("name")=="floatingButtonHere"){
			if($(this).is(':checked')){
				checkbox_values.push($(this).val());
			}else{
				removeItemAll($(this).val());
			}
		}
		if( checkbox_values.length == 0){
			$(".floatingButtonHere").hide();
		}else{
			$(".floatingButtonHere").show(150);
		}
		console.log(checkbox_values);
	});








		// search filter table
		$(document).ready(function(){
			$("#myInput").on("keyup", function() {
				var value = $(this).val().toLowerCase();
				$("#myTable tr").filter(function() {
					$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
				});
			});
		});





// for password change
    function change_name(name, pk){
		$("#name-change").html("Change Name for <b>"+name+"</b>");
		$("#alias_id").attr('value',pk);

		$('.imagepreview').attr('src', $(this).find('img').attr('src'));
		$('#imagemodal2').modal('show');

    }

	function myfun(){

		document.getElementById("div-1").style.display = "block";
		document.getElementById("div-3").style.display = "none";
		document.getElementById("div-2").style.display = "none";
		document.getElementById("div-4").style.display = "none";

	}

	function myfun1(){
		document.getElementById("div-1").style.display = "none";
		document.getElementById("div-2").style.display = "block";
		document.getElementById("div-3").style.display = "none";


	}

    // summary PWGs
	function myfun4(){
		document.getElementById("div-1").style.display = "none";
		document.getElementById("div-3").style.display = "none";
		document.getElementById("div-2").style.display = "block";
		document.getElementById("div-4").style.display = "none";


	}

	// add new pwgs
	function myfun5(){
		document.getElementById("floating-button").style.display = "none";
		document.getElementById("div-1").style.display = "none";
		document.getElementById("div-2").style.display = "none";
		document.getElementById("div-4").style.display = "block";
	}

	function assign(){
		document.getElementById("assign-hide").style.display = "none";
		document.getElementById("successfully").style.display = "block";
	}


	function transfer(){
		document.getElementById("transfer-hide").style.display = "none";
		document.getElementById("successfully-transfer").style.display = "block";
	}


	// to delete pwgs
	function myFunction() {
		document.getElementById("checkAll").disabled = false;
		$(".check").attr('disabled', false);
}

function cancel(){
    location.reload();
}

 // to show confirmation modal
function delete_multiple_users(){
	if ( checkbox_values.length == 1 ){
		$("#confirm-message-delete").html("Delete the selected "+checkbox_values.length+" Seller");
	}else{
		$("#confirm-message-delete").html("Delete the selected "+checkbox_values.length+" Sellers");
	}

	$("#confirm-modal-button").attr('onclick','sendpwgspk();');
	$('.imagepreview').attr('src', $(this).find('img').attr('src'));
	$('#imagemodalConfirm').modal('show');

}
function sendpwgspk(){
	$("#assign_values").attr('value', checkbox_values);
	document.forms['delete_multiple'].submit();

	checkbox_values = [];

}

// to submit alias change form
function submit_alias(){
    document.forms['submit_alias_change'].submit();
}
$(function() {
    $('#alias_value').on('input',function(){
        var val = $('#alias_value').val();
        if(val != '')
            $("#btn-alias").attr('disabled', false);
        else
            $("#btn-alias").attr('disabled', true);
    });
});

</script>
</body>
</html>